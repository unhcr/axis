<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." name="AXIS" >
  <target name="<%= @config[:name] %>">
    <sql
      driver="oracle.jdbc.OracleDriver"
      url="<%= @config[:db_url] %>"
      userid="FOCUS_READER"
      password="<%= ENV['DB_PASSWORD'] %>"
      print="true"
      showheaders="false"
      showtrailers="false"
      output="<%= @config[:output] %>">
      <classpath>
        <pathelement location="<%= @config[:location] %>"/>
      </classpath>
      <![CDATA[
      SELECT * FROM
          ( SELECT <%= @config[:fields].join(',') %>, sum(expenses_usd) as amount
          FROM FOCUS_BI.BI_EXPENSES b1 inner join FOCUS_BI.BI_OBJECTIVE b2
          ON b1.objectiveid = b2.objectiveid
          WHERE plan_type = 'P-8'
          GROUP BY <%= @config[:group_by].join(',') %>)
        <% unless @config[:limit].nil? %>
        WHERE rownum <= <%= @config[:limit] %>
        <% end %>
      ]]>
    </sql>
  </target>
</project>

